#: import utils kivy.utils
#: import Factory kivy.factory.Factory

PageManager:
    id:manager
    HomePage:
        id: home
    DataPage:
        id: data
    SettingsPage:
        id: settings

<ModelLabel1@Label>
    text_size: self.size
    halign: 'left'
    valign: 'middle'
    size_hint: 1, 1
<ModelLabel2@Label>
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    size_hint: 0.5, 1
<ModelLabel3@Label>
    text_size: self.size
    halign: 'center'
    valign: 'middle'
    size_hint: 0.5, 1

<CustButton@Button>:
    canvas.before:
        Color:
            rgba: (240/255, 148/255,22/255, 1)  #(55/255, 55/255, 55/255, 1)
        Rectangle:
            pos: self.pos
            size: self.size
    font_size: (root.width + root.height) / 5

<ModelButton@Button>:
    text_size: self.size
    font_size: (root.width + root.height) * 2
    color: (0,0,0,1)
    background_normal: ''
    background_color:(240/255, 133/255,22/255, 0.9)

<MenuButton@Button>:
    font_size: (root.width + root.height) / 10
    color: (0,0,0,1)
    background_normal: ''
    background_color:(240/255, 133/255,22/255, 0.9)

<SetDefModel@Popup>
    auto_dismiss: True
    size_hint: 0.92, 0.5
    pos_hint: {'x': 0.04, 'y': 0.35}
    title: "MОДЕЛЬ ПО УМОЛЧАНИЮ:"
    title_size: (root.width + root.height) / 40
    BoxLayout:
        orientation: 'vertical'
        GridLayout:
            cols: 2
            size_hint: 1, 0.6
            pos_hint: {'x': 0, 'y': 0.75}
            Label:
                id: 'model1'
                text: app.root.ids.settings.model1
            CheckBox:
                group: 'models'
                on_active: app.root.on_checkbox(self, self.active, 'model1')
            Label:
                text: app.root.ids.settings.model2
            CheckBox:
                group: 'models'
                on_active: app.root.on_checkbox(self, self.active, 'model2')
            Label:
                text: app.root.ids.settings.model3
            CheckBox:
                group: 'models'
                on_active: app.root.on_checkbox(self, self.active, 'model3')
            Label:
                text: app.root.ids.settings.model4
            CheckBox:
                group: 'models'
                on_active: app.root.on_checkbox(self, self.active, 'model4')
#        BoxLayout:
#            size_hint: 1, 0.25
#            pos_hint: {'x': 0, 'y': 0.15}
        Button:
            background_normal: ''
            background_color:(240/255, 148/255,22/255, 1)
            size_hint: 0.33, 0.08
            pos_hint: {'x': 0.33, 'y': 0}
            text: "ОК"
            text_size: self.size
            font_size: (root.width + root.height) / 25
            color: (0,0,0,1)
            halign: 'center'
            valign: 'middle'
            on_release: root.dismiss()

<CreateBasePop>:
    auto_dismiss: True
    size_hint: 0.85, 0.5
    pos_hint: {'x': 0.075, 'y': 0.3}
    title: "База данных для магнитофона:"
    BoxLayout:
        padding: 15
        spacing: 15
        orientation: 'vertical'
        ModelTextInput:
            hint_text: '18 CHARACTERS'
            font_name: 'data/font/AgencyFB.ttf'
            id: input_model
            multiline: False
            text_size: self.size
            font_size: (root.width + root.height) / 18
            halign: 'center'
            valign: 'center'
        Label:
            id: add_model_label
            size_hint: 1, 1
        Button:
            size_hint: .6, 0.9
            pos_hint: {"x": 0.2, "top":1}
            background_normal: ''
            background_color:(240/255, 148/255,22/255, 1)
            size: self.texture_size
            text: 'СОЗДАТЬ'
            text_size: self.size
            font_size: (root.width + root.height) / 25
            color: (0,0,0,1)
            halign: 'center'
            valign: 'middle'
            on_press: root.add_model(input_model.text)
        Button:
            size_hint: .6, 0.9
            pos_hint: {"x": 0.2, "top":1}
            background_normal: ''
            background_color:(240/255, 148/255,22/255, 1)
            size: self.texture_size
            text: "ОK"
            text_size: self.size
            font_size: (root.width + root.height) / 25
            color: (0,0,0,1)
            halign: 'center'
            valign: 'middle'
            on_release: root.dismiss()

<HomePage>:
    name: "home"
    display_side: side
    display_cass: cass
    display_model: model
    display_time: time_label
    FloatLayout:
        size: root.width, root.height
        Image:
            source:'data/logo.png'
            pos_hint: {"x": 0, "top": 1}
            text: "LOGO"
            size_hint: .8, .12
        Button:
            id: funct_choice
            background_normal: ''
            background_color:(0,0,0,0)
            size_hint: .2, .13
            pos_hint: {"x":.8, "top": 1}
            on_press: root.calculator_rel(entry.text)
            on_press: root.login_btn_press()
            on_release: root.login_btn_rel()
            on_release: delete_left.color = (1, 1, 1, 1)
            on_release: delete_right.color = (1, 1, 1, 1)
            Image:
                id: login_img1
                size_hint_y: None
                size_hint_x: None
                height: root.height / 5
                width: root.width / 5
                source:'data/login_1.png'
                center_x:self.parent.center_x
                center_y:self.parent.center_y
        BoxLayout:
            padding: 10, 0, 10 ,0
            orientation: 'horizontal'
            size_hint: 1, .05
            pos_hint: {"x":0, "top": .895}
            Label:
                id: time_label
#                size_hint: 0.4, .02
                text: root.now
                halign: 'left'
                valign: 'middle'
                text_size: self.size
                font_size:(root.width + root.height) / 50
                color: (1,1,1,1)
                bold: False
                outline_color: (0,0,0,1)
                outline_width:1
            Label:
                id: date_label
#                size_hint: .35, .035
                text: root.date
                halign: 'left'
                valign: 'middle'
                text_size: self.size
                font_size:(root.width + root.height) / 50
                color: (1,1,1,1)
                bold: False
                outline_color: (0,0,0,1)
                outline_width:1
            Label:
#                text: 'FUNCTION'
                font_size:(root.width + root.height) / 50
                text_size: self.size
                halign: 'right'
                valign: 'middle'

        Button:
            id: model
            text: root.current_base
            font_size: (root.width + root.height) / 45
            pos_hint: {'x': 0, 'top': .85}
            size_hint: 1, .07
            on_press: Factory.SetDefModel().open()
        Button:
            id: delete_left
            text: ">>>"
            text_color: utils.get_color_from_hex('#FF5733')
            font_size: (root.width + root.height) / 45
            pos_hint: {'x': 0, 'top': .78}
            size_hint: .33, .07
            on_press: entry.text = ""
            on_press: cass.text = ""
            on_press: side.text = ""
        Label:
            id: entry
            background_color: (240/255, 148/255,22/255, 1)
            canvas.before:
                Color:
                    rgba: self.background_color
                Rectangle:
                    size: self.size
                    pos: self.pos
            # text Properties
            color: (0,0,0,1)
            bold: False
            outline_color: (1,1,1,1)
            outline_width:0.5
            font_size: (root.width + root.height) / 30
            multiline: False
            pos_hint: {'x': 0.33, 'top': .78}
            size_hint: .34, .07
        Button:
            id: delete_right
            text: "<<<"
            font_size: (root.width + root.height) / 45
            pos_hint: {'x': 0.67, 'top': .78}
            size_hint: .33, .07
            on_press: entry.text = entry.text[0:-1]
            on_press: side.text = ""
            on_press: cass.text = ""
        Button:
            text: "ВРЕМЯ ЗВУЧАНИЯ"
            font_size: (root.width + root.height) / 45
            pos_hint: {'x': 0, 'top': .71}
            size_hint: 1, .072
            on_press: root.calculator_abs(entry.text)
            on_release: model.color = (1, 1, 1, 1)
            on_release: delete_left.color = (1, 1, 1, 1)
            on_release: delete_right.color = (1, 1, 1, 1)
        Label:
            text: "СТОРОНА"
            background_color: (80/255, 80/255, 80/255, 1)
            font_size: (root.width + root.height) / 45
            pos_hint: {'x': .502, 'top': .638}
            size_hint: .5, .07
            canvas.before:
                Color:
                    rgba: self.background_color
                Rectangle:
                    size: self.size
                    pos: self.pos
        Label:
            font_size: (root.width + root.height) / 45
            text: "КАССЕТА"
            background_color: (80/255, 80/255, 80/255, 1)
            pos_hint: {'x': 0, 'top': .638}
            size_hint: .498, .07
            canvas.before:
                Color:
                    rgba: self.background_color
                Rectangle:
                    size: self.size
                    pos: self.pos
        Label:
            id: side
            background_color: (80/255, 80/255, 80/255, 1)
            font_size: (root.width + root.height) / 33
            pos_hint: {'x': .502, 'top': .57}
            size_hint: .498, .07
            canvas.before:
                Color:
                    rgba: self.background_color
                Rectangle:
                    size: self.size
                    pos: self.pos
        Label:
            id: cass
            background_color: (80/255, 80/255, 80/255, 1)
            font_size: (root.width + root.height) / 33
            pos_hint: {'x': 0, 'top': .57}
            size_hint: .498, .07
            canvas.before:
                Color:
                    rgba: self.background_color
                Rectangle:
                    size: self.size
                    pos: self.pos
        BoxLayout:
            orientation: 'horizontal'
            GridLayout:
                pos_hint: {'x': 0, 'y': .1}
                size_hint: 0.66, .4
                id: calculator
                display: entry
                cols: 3
                padding: 35
                spacing: 35
                CustButton:
                    text: "7"
                    id: cus_button7
                    on_press: root.cust_button_press(7)
                CustButton:
                    text: "8"
                    on_press: root.cust_button_press(8)
                CustButton:
                    text: "9"
                    on_press: root.cust_button_press(9)
                CustButton:
                    text: "4"
                    on_press: root.cust_button_press(4)
                CustButton:
                    text: "5"
                    on_press: root.cust_button_press(5)
                CustButton:
                    text: "6"
                    on_press: root.cust_button_press(6)
                CustButton:
                    text: "3"
                    on_press: root.cust_button_press(3)
                CustButton:
                    text: "2"
                    on_press: root.cust_button_press(2)
                CustButton:
                    text: "1"
                    on_press: root.cust_button_press(1)
                Image:
                    source: 'data/login_3.png'
                CustButton:
                    text: "0"
                    on_press: root.cust_button_press(0)
                Image:
                    source: 'data/login_3.png'
            BoxLayout:
                padding: 10
                spacing: 10
                orientation: 'vertical'
                pos_hint: {'x': 0.5, 'y': .1}
                size_hint: 0.34, .4
                Label:
                    size_hint: 1, .4
                    text: "МОДЕЛЬ:"
                    text_size: self.size
                    valign: 'top'
                    halign: 'center'
                ToggleButton:
                    state: 'down'
                    group: 'models'
                    text: "№ 1"
                    on_release: root.display_model.text = root.manager.ids.settings.model1
                ToggleButton:
                    group: 'models'
                    text: "№ 2"
                    on_release: root.display_model.text = root.manager.ids.settings.model2
                ToggleButton:
                    text: "№ 3"
                    group: 'models'
                    on_release: root.display_model.text = root.manager.ids.settings.model3
                ToggleButton:
                    text: "№ 4"
                    group: 'models'
                    on_release: root.display_model.text = root.manager.ids.settings.model4
        BoxLayout:
            padding: 10
            spacing: 15
#            pos_hint: {'x': 0, 'y': 0}
            size_hint: 1, 0.12
            cols:1
            MenuButton:
                size_hint: 1, 0.7
                pos_hint: {"x": 0.1, "y": 0.15}
                text:'МОДЕЛИ'
                on_release:
                    app.root.current = "settings"
                    root.manager.transition.direction = 'right'
            MenuButton:
                size_hint: 1, 0.7
                pos_hint: {"x": 0.6, "y": 0.15}
                text:'ВЫХОД'
                on_release: app.exit_app()
            MenuButton:
                size_hint: 1, 0.7
                pos_hint: {"x": 0.9, "y": 0.15}
                text:'МОДЕЛЬ'
                on_release:
                    app.root.current = 'data'
                    root.manager.transition.direction = 'left'
<DataPage>:
    name:"data"
    counter_input: counter_input
    timer_input: timer_input
    FloatLayout:
        Button:
            pos_hint: {"x":0, "top": 1}
            size_hint: 0.35, 0.07
            color: (0,0,0,1)
            background_normal: ''
            background_color:(240/255, 148/255,22/255, 1)
            text_color:
            size: self.texture_size
            text: '  < НАЗАД'
            text_size: self.size
            font_size: (root.width + root.height) / 55
            halign: 'left'
            valign: 'middle'
            on_press:
                app.root.current = 'home'
                root.manager.transition.direction = 'right'
        Label:
            pos_hint: {"x":0.35, "top": 1}
            size_hint: 0.65, 0.07
            background_color: (240/255, 148/255,22/255, 1)
            font_size: (root.width + root.height) / 55
            text_size: self.size
            color: (0,0,0,1)
            halign: 'right'
            valign: 'middle'
            text: 'БАЗА ДАННЫХ  '
            bold: False
            canvas.before:
                Color:
                    rgba: self.background_color
                Rectangle:
                    size: self.size
                    pos: self.pos

        Label:
            pos_hint: {"x":0, "top": 0.95}
            size_hint: 0.5, 0.1
            text_size: self.size
            font_size: (root.width + root.height) / 50
            text: "Магнитофон:"
            halign: 'right'
        Label:
            id: model
            pos_hint: {"x":0.55, "top": 0.95}
            size_hint: 0.95, 0.1
            text_size: self.size
            font_size: (root.width + root.height) / 50
            text: root.current_base
            halign: 'left'
        Label:
            pos_hint: {"x":0, "top": 0.895}
            size_hint: 0.5, 0.1
            text_size: self.size
            font_size: (root.width + root.height) / 50
            text: "001 счётчика:"
            halign: 'right'
        Label:
            id: models
            pos_hint: {"x":0.55, "top": 0.895}
            size_hint: 0.95, 0.1
            text_size: self.size
            font_size: (root.width + root.height) / 50
            halign: 'left'
            text: root.count_one   + ' сек.'
        Label:
            pos_hint: {"x":0, "top": 0.84}
            size_hint: 0.5, 0.1
            text_size: self.size
            font_size: (root.width + root.height) / 50
            text: "Кассет в базе:"
            halign: 'right'
        Button:
            id: add_label
            pos_hint: {"x":0, "top": 0.72}
            size_hint: 1, 0.06
            background_normal: ''
            background_color: (100/255, 100/255, 100/255, 1)
            text: "НОВОЕ ПОКАЗАНИЕ:"
            font_size: (root.width + root.height) / 50
            on_press: counter_input.text = ""
            on_press: timer_input.text = ""
            on_release: self.text = "НОВОЕ ПОКАЗАНИЕ:"
        Label:
            id: readings
            pos_hint: {"x":0.55, "top": 0.84}
            size_hint: 0.95, 0.1
            text_size: self.size
            font_size: (root.width + root.height) / 50
            halign: 'left'
            text:root.readings
        Label:
            id: counter_label
            pos_hint: {"x":0, "top": 0.65}
            size_hint: 1, 0.06
            background_color: (100/255, 100/255, 100/255, 1)
            text: "СЧЁТЧИК:                       ОБОРОТОВ"
            color: (1,1,1,1)
            font_size: (root.width + root.height) / 60
            canvas.before:
                Color:
                    rgba: self.background_color
                Rectangle:
                    size: self.size
                    pos: self.pos
        CounterTextInput:
            id: counter_input
            multiline: False
            input_type: 'number'
            input_filter: 'int'
            pos_hint: {"x":0.4, "top": 0.65}
            size_hint: 0.2, 0.06
            halign: 'center'
            valign: 'center'
            text_size: self.size
            font_size: (root.width + root.height) / 40
        Label:
            id: timer_label
            pos_hint: {"x":0, "top": 0.58}
            size_hint: 1, 0.06
            background_color: (100/255, 100/255, 100/255, 1)
            text: "ВРЕМЯ:                              Ч:М:С  "
            color: (1,1,1,1)
            font_size: (root.width + root.height) / 60
            canvas.before:
                Color:
                    rgba: self.background_color
                Rectangle:
                    size: self.size
                    pos: self.pos
        TimerTextInput:
            id: timer_input
            multiline: False
            input_type: 'datetime'
            pos_hint: {"x":0.35, "top": 0.58}
            size_hint: 0.3, 0.06
            text_size: self.size
            font_size: (root.width + root.height) / 40
            halign: 'center'
            valign: 'center'
        Button:
            id: add_btn
            pos_hint: {"x":0.325, "top": 0.51}
            size_hint: 0.35, 0.06
            color: (0,0,0,1)
            background_normal: ''
            background_color:(240/255, 148/255,22/255, 1)
            size: self.texture_size
            text: 'ДОБАВИТЬ'
            text_size: self.size
            font_size: (root.width + root.height) / 55
            halign: 'center'
            valign: 'middle'
            on_press: root.add_new_reading(counter_input.text, timer_input.text)
            on_release: counter_label.color = (1,1,1,1)
            on_release: timer_label.color = (1,1,1,1)
        ToggleButton:
            id: timer_start
            group:'timer'
            pos_hint: {"x":0.04, "top": 0.51}
            size_hint: 0.24, 0.06
            color: (0,0,0,1)
            background_normal: ''
            background_color:(240/255, 148/255,22/255, 1)
            size: self.texture_size
            text: 'ТАЙМЕР ПУСК'
            text_size: self.size
            font_size: (root.width + root.height) / 75
            halign: 'center'
            valign: 'middle'
            on_press: root.timer_start()
        ToggleButton:
            id: timer_stop
            group:'timer'
            pos_hint: {"x":0.72, "top": 0.51}
            size_hint: 0.25, 0.06
            color: (0,0,0,1)
            background_normal: ''
            background_color:(240/255, 148/255,22/255, 1)
            size: self.texture_size
            text: 'ТАЙМЕР  СТОП'
            text_size: self.size
            font_size: (root.width + root.height) / 75
            halign: 'center'
            valign: 'middle'
            on_press: root.timer_stop()
            on_press: text: 'ТАЙМЕР СТОП'

        Label:
            id: update_label
            pos_hint: {"x":0, "top": 0.15}
            size_hint: 1, 0.06
            background_color: (100/255, 100/255, 100/255, 1)
            color: (1,1,1,1)
            font_size: (root.width + root.height) / 60
            canvas.before:
                Color:
                    rgba: self.background_color
                Rectangle:
                    size: self.size
                    pos: self.pos
        Button:
            id: rest_btn
            pos_hint: {"x":0.7, "top": 0.08}
            size_hint: 0.28, 0.048
            color: (0,0,0,1)
            background_normal: ''
            background_color:(240/255, 148/255,22/255, 1)
            size: self.texture_size
            text: 'RESTORE'
            text_size: self.size
            font_size: (root.width + root.height) / 95
            halign: 'center'
            valign: 'middle'
            disabled: False
            on_release: root.restore_data()
        Button:
            id: back_btn
            pos_hint: {"x":0.02, "top": 0.08}
            size_hint: 0.28, 0.048
            color: (0,0,0,1)
            background_normal: ''
            background_color:(240/255, 148/255,22/255, 1)
            size: self.texture_size
            text: 'BACKUP'
            text_size: self.size
            font_size: (root.width + root.height) / 95
            halign: 'center'
            valign: 'middle'
            disabled: False
            on_release: root.save_data()
        Image:
            source:'data/google.png'
            pos_hint: {"x":0.32, "top": 0.08}
            size_hint: .35, .07

<SettingsPage>:
    name:"settings"
    id: sett_layout
    FloatLayout:
        Button:
            pos_hint: {"x":0.35, "top": 1}
            size_hint: 0.65, 0.07
            color: (0,0,0,1)
            background_normal: ''
            background_color:(240/255, 148/255,22/255, 1)
            text_color:
            size: self.texture_size
            text: 'НАЗАД >  '
            text_size: self.size
            font_size: (root.width + root.height) / 55
            halign: 'right'
            valign: 'middle'
            on_press:
                app.root.current = 'home'
                root.manager.transition.direction = 'left'
        Label:
            pos_hint: {"x":0, "top": 1}
            size_hint: 0.35, 0.07
            background_color: (240/255, 148/255,22/255, 1)
            font_size: (root.width + root.height) / 55
            text_size: self.size
            color: (0,0,0,1)
            halign: 'left'
            valign: 'middle'
            text: '  НАСТРОЙКИ'
            bold: False
            canvas.before:
                Color:
                    rgba: self.background_color
                Rectangle:
                    size: self.size
                    pos: self.pos
        Label:
            pos_hint: {"x":0, "top": 0.93}
            size_hint: 1, 0.04
            id: new_base_label
        GridLayout:
            padding: 15
            pos_hint: {"x":0, "top": 0.92}
            size_hint: 1, 0.3
            rows: 5
            cols: 3
            ModelLabel1:
                text: "МОДЕЛЬ:"
            ModelLabel2:
                text: "СЧЁТЧИК:"
            ModelLabel3:
                text: "КАССЕТ:"
            ModelLabel1:
                text: root.model1
            ModelLabel2:
                text: 'wer' + ' сек.'
            ModelLabel3:
                text:'wer'
            ModelLabel1:
                text: root.model2
            ModelLabel2:
                text:'wer' + ' сек.'
            ModelLabel3:
                text:'wer'
            ModelLabel1:
                text: root.model3
            ModelLabel2:
                text: 'wer' + ' сек.'
            ModelLabel3:
                text:'wer'
            ModelLabel1:
                text:root.model4
            ModelLabel2:
                text:'wer' + ' сек.'
            ModelLabel3:
                text:'wer'
        BoxLayout:
            orientation: 'vertical'
            pos_hint: {"x":0, "top": 0.68}
            size_hint: 1, .8
            Splitter:
                sizable_from: 'top'
                TabbedPanel:
                    do_default_tab: False
                    TabbedPanelItem:
                        font_size: '9sp'
                        text: root.model1
                        BoxLayout:
                    TabbedPanelItem:
                        font_size: '9sp'
                        text: root.model2
                        BoxLayout:
                    TabbedPanelItem:
                        font_size: '9sp'
                        text: root.model3
                        BoxLayout:
                    TabbedPanelItem:
                        font_size: '9sp'
                        text: root.model4
                        Image:
                            size_hint_y: None
                            size_hint_x: None
                            height: root.height
                            width: root.width
                            source:'data/google.png'
#                            center_x:self.parent.center_x
#                            center_y:self.parent.center_y

        Button:
            id: new_base_butt
            pos_hint: {"center_x":0.5, "top": 0.07}
            size_hint: 0.45, 0.05
            color: (0,0,0,1)
            background_normal: ''
            background_color:(240/255, 148/255,22/255, 1)
            size: self.texture_size
            text: 'ДОБАВИТЬ МОДЕЛЬ'
            text_size: self.size
            font_size: (root.width + root.height) / 65
            halign: 'center'
            valign: 'middle'
            on_press: self.text = 'ДОБАВИТЬ МОДЕЛЬ'
            on_release: Factory.CreateBasePop().open()







